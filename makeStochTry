#Flags, Compilers, Linkers
#LINK = ifort
LINK = gfortran
#FC = ifort
FC = gfortran
SPAMADIR = /msu/home/m1gsa00/git/sparseAMAParser/sparseAMA
FFLAGS = -c -g -I$(SPAMADIR)/src/main/include
#CC = icc
CC = gcc
#CFLAGS = -c -g -I$(SPAMADIR)/src/main/include
LAPACKLIBS=  -L/opt/atlas/lib/ -lcblas -lf77blas -latlas -llapack
#NEWSPARSKITLOC = /msu/res2/m1gsa00/proj3/dataHome/sparse/SPARSKIT2
#NEWSPARSKITLOC = /msu/res2/m1gsa00/aim/SPARSKIT2
#NEWSPARSKITLOC = /msu/res2/m1gsa00/proj3/garyFiles/tryonSparseAim/sparseAim/libskit.a
NEWSPARSKITLOC = /msu/res1/Software/SPARSKIT2
SYSTEM= -DUNIX
#FILTER = /mq/home/m1gsa00/aim/sparse/nuweb_filter.pl
FILTER= /msu/res2/m1gsa00/proj3/garyFiles/big/cFiles/nuwebTree/nuweb_filter.pl
FRBUSDIR=$(HOME)/aim/frbus
CFLAGS = -O4  -DUNIX -DCLOCK  -I$(SPAMADIR)/src/main/include
#SPARSELIB = -L$(NEWSPARSKITLOC) -lskit \
#		  -L/mq/home/m1gsa00/matlab/ranlib_c-93/src -lran 
#SPARSELIB = -L$(NEWSPARSKITLOC) -lskit \
#		  /msu/res2/m1gsa00/aim/cpStochSims/ranlib.o
SPARSELIB =   /msu/res2/m1gsa00/aim/cpStochSims/ranlib.o



debCFLAGS = -g  -pg -DUNIX -DCLOCK  -I$(SPAMADIR)/src/main/include

fastCFLAGS =  -O4 -DUNIX -DCLOCK   -I$(SPAMADIR)/src/main/include
#fastSPARSELIB = -L$(NEWSPARSKITLOC) -lskit \
#			  -L/mq/home/m1gsa00/matlab/ranlib_c-93/src -lran 
#fastSPARSELIB = -L$(NEWSPARSKITLOC) -lskit \
#		  /msu/res2/m1gsa00/aim/cpStochSims/ranlib.o
fastSPARSELIB = 	  /msu/res2/m1gsa00/aim/cpStochSims/ranlib.o

LINTFLAGS = -b -c  -h 
#LINKFLAGS =  -v  -lc -ldl -lm -L$(HOME)/aim/sparse -lsparseAim
LINKFLAGS =  -v  -lc -ldl -lm -L/msu/home/m1gsa00/git/sparseAMAParser/sparseAMA/target/nar/sparseAMA-1.0-SNAPSHOT-amd64-Linux-g++-shared/lib/amd64-Linux-g++/shared -lsparseAMA-1.0-SNAPSHOT


#LAPACKLIB  = /mq/home/m1gsa00/aim/summer98/aimCCode/lapack_os5.a \
#		   /mq/home/m1gsa00/aim/summer98/aimCCode/blas_os5.a

#fastLAPACKLIB  = /mq/home/m1gsa00/lapack/LAPACK/lapack_os5.a \
#			   /mq/home/m1gsa00/lapack/LAPACK/blas_os5.a
fastLAPACKLIB  = $(LAPACKLIB)

WEBSOURCE =  stackC.w stochProto.w stochRun.w
CSOURCE   = $(WEBSOURCE:.w=.c)
TEXSOURCE   = $(WEBSOURCE:.w=.tex)
HTMLSOURCE   = $(WEBSOURCE:.hw=.tex)
atIFiles	= 

#OTHERSOURCE = /mq/home/m1gsa00/aim/frbus/miscLatexPkg.tex
OTHERSOURCE = /msu/res2/m1gsa00/proj3/garyFiles/big/cFiles/nuwebTree/miscLatexPkg.tex
SOURCE = $(CSOURCE)  $(OTHERSOURCE)

OBJECT = $(SOURCE:.c=.o)
LINTFILE = $(CSOURCE:.c=.ln)

.SUFFIXES:	.tex .dvi .w .print .c .hw .html .ps .pdf

.hw.html:
	nuweb $*.hw
	latex2html -split 0 -no_reuse -no_navigation $*.tex

.w.hw:
	cp $*.w $*.hw

.w.tex:
	nuweb $(NUWEBFLAGS) $*
.dvi.ps:
	dvips -PDF -o $*.ps $*

.ps.pdf:
	distill $*.ps


.tex.dvi:
	latex $*
	bibtex $*
	nuweb  $(NUWEBFLAGS) $*
	latex $*
	latex $*


.w.dvi:
	nuweb  $(NUWEBFLAGS) $*
	latex $*
	bibtex $*
	nuweb  $(NUWEBFLAGS) $*
	latex $*
	latex $*

.w.c:
	nuweb -t $*

.w.o:
	make $*.c
	make $*.o

.c.o:
	$(CC) $(CFLAGS) -c $*.c

.f.o:
	$(FC) $(CFLAGS) -c $*.f

.dvi.print:
	$(PLPR) $*

# Dependency rules

stackC.w:	$(atIFiles) 
	touch stackC.w


lint:	$(LINTFILE)

printall:	

stochRun:	stochRun.o stackC.o  myNewt.o dtime.o\
			ma50ad.o stochProto.o julliard.o ranlib.o
		$(LINK) -o stochRun -O4 stochRun.o myNewt.o dtime.o\
		stackC.o julliard.o ma50ad.o stochProto.o\
		$(fastSPARSELIB) $(LINKFLAGS) $(fastLAPACKLIB)


myNewt.c:			 stackC.w
		nuweb $(NUWEBFLAGS) -t stackC.w


debStackC.o:		stackC.c
		$(CC) $(debCFLAGS) -o debStackC.o -c stackC.c  
debMyNewt.o:		myNewt.c
		$(CC) $(debCFLAGS) -o debMyNewt.o -c myNewt.c  
debStochRun.o:		stochRun.c
		$(CC) $(debCFLAGS) -o debStochRun.o -c stochRun.c  
debStochProto.o:		stochProto.c
		$(CC) $(debCFLAGS) -o debStochProto.o -c stochProto.c  
debJulliard.o:		julliard.c
		$(CC) $(debCFLAGS) -o debJulliard.o -c julliard.c  
debStochRun:	debStochRun.o debStackC.o  debMyNewt.o dtime.o\
			ma50ad.o debStochProto.o debJulliard.o ranlib.o
		$(LINK) -o debStochRun -O4 debStochRun.o debMyNewt.o dtime.o\
		debStackC.o debJulliard.o ma50ad.o debStochProto.o\
		$(fastSPARSELIB) $(LINKFLAGS) $(fastLAPACKLIB)





#this shouldn't be necessary for insure, but 
#in our experience, the program was confused(especially for coverage comp)
# by linenumber directives 
#that referred to the .w files.

insstochProto.o:			 stochProto.c
		$(FILTER) < stochProto.c > nlstochProto.c 
		insure -g -o insstochProto.o -c nlstochProto.c 
insstochRun.o:			 stochRun.c
		$(FILTER) < stochRun.c > nlstochRun.c 
		insure -g -o insstochRun.o -c nlstochRun.c 
insstackC.o:			 stackC.c
		$(FILTER) < stackC.c > nlStackC.c 
		insure -g -o insstackC.o -c nlStackC.c 
insjulliard.o:			 julliard.c
		$(FILTER) < julliard.c > nljulliard.c 
		insure -g -o insjulliard.o -c nljulliard.c 
insmyNewt.o:			 myNewt.c
		$(FILTER) < myNewt.c > nlmyNewt.c 
		insure -g -I$(SPAMADIR)/src/main/include -o insmyNewt.o -c nlmyNewt.c 
inssparseAim.o:			 $(HOME)/aim/sparse/sparseAim.c
		$(FILTER) < $(HOME)/aim/sparse/sparseAim.c > nlsparseAim.c 
		insure -g -I$(SPAMADIR)/src/main/include -o inssparseAim.o -c nlsparseAim.c 



insurestochRun:	insstochRun.o insstackC.o  insjulliard.o insmyNewt.o\
				 ma50ad.o inssparseAim.o insstochProto.o
		ins_ld  -g -o insurestochRun \
		insstochRun.o \
		insmyNewt.o insstackC.o insjulliard.o ma50ad.o insstochProto.o\
		$(SPARSELIB) inssparseAim.o $(LINKFLAGS) $(LAPACKLIB) 

		

raystochProto.o:			 stochProto.c
		$(FILTER) < stochProto.c > nlstochProto.c 
		$(CC) -g -o raystochProto.o -c nlstochProto.c 
raystochRun.o:			 stochRun.c
		$(FILTER) < stochRun.c > nlstochRun.c 
		$(CC) -g -o raystochRun.o -c nlstochRun.c 
raystackC.o:			 stackC.c
		$(FILTER) < stackC.c > nlStackC.c 
		$(CC) -g -o raystackC.o -c nlStackC.c 
rayjulliard.o:			 julliard.c
		$(FILTER) < julliard.c > nljulliard.c 
		$(CC) -g -o rayjulliard.o -c nljulliard.c 
raymyNewt.o:			 myNewt.c
		$(FILTER) < myNewt.c > nlmyNewt.c 
		$(CC) -g -I$(SPAMADIR)/src/main/include -o raymyNewt.o -c nlmyNewt.c 
raysparseAim.o:			 $(SPAMADIR)/src/main/sparseAim.c
		$(FILTER) < $(SPAMADIR)/src/main/sparseAim.c > nlsparseAim.c 
		$(CC) -g -I$(SPAMADIR) -o raysparseAim.o -c nlsparseAim.c 




raystochRun:	raystochRun.o raystackC.o  rayjulliard.o raymyNewt.o\
				 ma50ad.o raysparseAim.o raystochProto.o
		$(LINK)  -g -o raystochRun \
		raystochRun.o \
		raymyNewt.o raystackC.o rayjulliard.o ma50ad.o raystochProto.o\
		$(SPARSELIB) raysparseAim.o $(LINKFLAGS) $(LAPACKLIB) 

		


canadaRun:	canadaRun.o stackC.o  canada.o myNewt.o\
				 ma50ad.o  stochProto.o
		$(LINK)  -g -o canadaRun \
		canadaRun.o \
		myNewt.o stackC.o canada.o ma50ad.o stochProto.o\
		$(SPARSELIB)  $(LINKFLAGS) $(LAPACKLIB) 



inscanadaRun.o:			 canadaRun.c
		$(FILTER) < canadaRun.c > nlcanadaRun.c 
		insure -g -o inscanadaRun.o -c nlcanadaRun.c 


inscanada.o:			 canada.c
		$(FILTER) < canada.c > nlcanada.c 
		insure -g -o inscanada.o -c nlcanada.c 


insurecanadaRun:	inscanadaRun.o insstackC.o  inscanada.o insmyNewt.o\
				 ma50ad.o  inssparseAim.o insstochProto.o
		ins_ld  -g -o insurecanadaRun \
		inscanadaRun.o \
		insmyNewt.o insstackC.o inscanada.o ma50ad.o insstochProto.o\
		$(SPARSELIB) inssparseAim.o  $(LINKFLAGS) $(LAPACKLIB) 
